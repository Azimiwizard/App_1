{% extends "base.html" %}

{% block title %}Order Confirmation{% endblock %}

{% block head %}
{{ super() }}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
<style>
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-fade-in-up {
        animation: fadeInUp 0.6s ease-out forwards;
    }

    .animation-delay-200 {
        animation-delay: 200ms;
    }

    .animation-delay-400 {
        animation-delay: 400ms;
    }

    .animation-delay-600 {
        animation-delay: 600ms;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-lg mx-auto text-center py-12 px-4">
    <div class="opacity-0 animate-fade-in-up">
        <span class="material-symbols-outlined text-8xl text-green-500">
            check_circle
        </span>
    </div>

    <div class="opacity-0 animate-fade-in-up animation-delay-200">
        <h2 class="mt-4 text-3xl font-extrabold text-text-dark dark:text-text-light tracking-tight">Order Placed
            Successfully!</h2>
        <p class="mt-2 text-base text-gray-500 dark:text-gray-400">
            Your order #{{ order.id }} is confirmed and is being prepared.
        </p>
    </div>

    <div class="mt-8 bg-gray-50 dark:bg-gray-800 rounded-lg p-4 opacity-0 animate-fade-in-up animation-delay-400">
        <div class="flex justify-between items-center text-lg">
            <span class="font-medium text-gray-600 dark:text-gray-300">Order Total:</span>
            <span class="font-bold text-primary text-xl">Dh{{ '%.2f'|format(order.total) }}</span>
        </div>
        {% if discount > 0 %}
        <div class="flex justify-between items-center text-sm mt-2">
            <span class="text-gray-500 dark:text-gray-400">Discount Applied:</span>
            <span class="text-green-600 dark:text-green-400">-Dh{{ '%.2f'|format(discount) }}</span>
        </div>
        {% endif %}
        <div class="flex justify-between items-center text-sm mt-2">
            <span class="text-gray-500 dark:text-gray-400">Points Earned:</span>
            <span class="text-blue-600 dark:text-blue-400">{{ order.points_earned }}</span>
        </div>
        <div class="flex justify-between items-center text-sm mt-2">
            <span class="text-gray-500 dark:text-gray-400">Order Status:</span>
            <span id="order-status" class="text-blue-600 dark:text-blue-400">{{ order.status }}</span>
        </div>
    </div>

    <div class="mt-10 opacity-0 animate-fade-in-up animation-delay-600">
        <a href="{{ url_for('menu') }}"
            class="inline-block bg-primary text-white font-bold py-3 px-8 rounded-lg shadow-lg hover:bg-primary/90 transition-colors">
            Continue Browsing
        </a>
    </div>
</div>

<script>
    const socket = io();
    socket.on('order_status_update', function (data) {
        if (data.order_id == "{{ order.id }}") {
            document.getElementById('order-status').textContent = data.status;
        }
    });
</script>
{% endblock %}